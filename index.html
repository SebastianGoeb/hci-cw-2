<html>
  <head>
    <title>New Students</title>
    <!-- Fix scaling for mobile users (good practice) -->
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />

    <!-- EXTERNAL DEPENDENCIES -->
    <!-- Roboto (the Android font) because it's pretty -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,500">
    <!-- Font Awesome for pretty icons -->
    <script src="https://use.fontawesome.com/dd225ee618.js"></script>
    <!-- jQuery because it's easier to work with than native dom code -->
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>

    <!-- PROJECT DEPENDENCIES -->
    <link href="typography.css" rel="stylesheet">
    <!-- Custom CSS -->
    <style>
      /* Layout */
      body {
        display: flex;
        margin: 0;
      }
      #map {
        flex-grow: 1;
      }
      #places {
        flex-basis: 20em;
        order: 1;
        padding: 1em;
        box-shadow: -0px 0 20px #000
      }
      #search {
        display: flex;
        align-items: baseline;
      }
      /* Accordion things */
      .accordion {
        display: flex;
        flex-direction: column;
      }
      .accordion > header {
        display: flex;
        align-items: baseline;
        cursor: pointer;
      }
      .accordion > header > .fa {
        padding: 1em;
        transition: all 300ms ease-out;
      }
      .accordion > header.closed > .fa {
        transform: rotate(-90deg);
      }
      .accordion > section {
        display: flex;
        flex-direction: column;
        transition: all 300 ease-out;
      }
      .accordion > section.closed{
        display: none;
      }
      label[for="search-input"] {
        padding: 1em;
        margin-right: -3rem;
        flex-basis: 1rem;
        text-align: center;
        z-index: 99;
      }
      input[type="search"] {
        border: 1px solid black;
        flex-grow: 1;
        align-self: stretch;
        padding: 1em 1em 1em 3rem;
      }
    </style>
  </head>
  <body>
    <!-- Main map section -->
    <section id="map">
    </section>
    <!-- Quick links to places and information -->
    <aside id="places">
      <!-- Search subsection -->
      <section id="search">
        <label for="search-input"><i class="fa fa-search"></i></label>
        <input id="search-input" type="search" autcomplete="off" autocorrect="off" placeholder="Search">
      </section>
      <!-- Button subsection -->
      <section id="place-buttons" class="accordion">
      </section>
    </aside>
    <!-- Functionality -->
    <script>
      // Place data
      var placeGroups = [{
        title: 'Accommodation',
        places: [{
          latLng: {lat: 55.940417, lng: -3.171280},
          title: 'Pollock Halls',
          content: '<h3>Pollock Halls</h3><p>This is Pollock Halls. Freshers live here.</p>',
          subplaces: []
        }]
      }, {
        title: 'Uni Buildings',
        places: [{
          latLng: {lat: 55.946036, lng: -3.192112},
          title: 'Forret Hill',
          content: '<h3>Forret Hill</h3><p>This is Forrest Hill. You can find the ITO and IGS here.</p>',
          subplaces: ['ITO', 'IGS']
        }, {
          latLng: {lat: 55.944757, lng: -3.187455},
          title: 'Informatics Forum',
          content: '<h3>Informatics Forum</h3><p>This is the Informatics Forum. You can find PhD offices here.</p>',
          subplaces: ['PhD offices']
        }]
      }, {
        title: 'Banks',
        places: [{
          latLng: {lat: 55.946208, lng: -3.184974},
          title: 'Royal Bank of Scotland',
          content: '<h3>Royal Bank of Scotland(RBS) Nicolson Street</h3><p>RBS offers a <a href="http://personal.rbs.co.uk/personal/current-accounts/compare-current-accounts/student-account.html">student account</a> which is available to international students with <a href="http://personal.rbs.co.uk/personal/current-accounts/compare-current-accounts/student-account/student-account-international-students.html">minor modifications</a>.</p>',
          subplaces: ['international student account']
        },
        {
            latLng: {lat: 55.953436, lng: -3.190249},
            title: 'Barclays',
            content: '<h3>Barclays Bank</h3><p>Barclays offers student accounts for both domestic and international students. For more  information visit the <a href="http://www.barclays.co.uk/current-accounts/student-accounts">domestic</a> or <a href="http://www.barclays.co.uk/current-accounts/international-student-accounts">international</a> student account page or visit <a href="http://www.barclays.co.uk">www.barclays.co.uk</a>.</p>',
            subplaces: ['international student account']
        },
        {
            latLng: {lat: 55.949021, lng: -3.192829},
            title: 'Bank of Scotland',
            content: '<h3>Bank of Scotland<h3><p>Bank of Scotland offers a <a href="https://www.bankofscotland.co.uk/bankaccounts/compare-current-accounts/student-account/">student accoutn</a> that is available to any student who has had a permanent UK address for the past 3 years.',
            subplaces: []
        },
        {
            latLng: {lat: 55.951117, lng: -3.203165},
            title: 'HSBC',
            content: '<h3>HSBC</h3><p>HSBC offers a <a href="http://www.hsbc.co.uk/1/2/current-accounts/student-bank-account#/overview">student account</a>. They also offer options for international students. Information about these can be found <a href="http://www.hsbc.co.uk/1/2/current-accounts/student-bank-account#/international-students">here</a> and <a href="http://www.hsbc.co.uk/1/2/current-accounts/basic-bank-account">here</a></p>',
            subplaces: ['international account']
        },
        {
            latLng: {lat: 55.945405, lng: -3.186780},
            title: 'Santander',
            content: '<h3>Santander</h3><p>Santander offer accounts for both <a href="http://www.santander.co.uk/uk/current-accounts/student-graduate-current-accounts/123-student-current-account">domestic</a> and <a href="http://www.santander.co.uk/uk/current-accounts/student-graduate-current-accounts/international-student-current-account">international students</a></p>',
            subplaces: ['international student account']
        },
        {
            latLng: {lat: 55.953951, lng: -3.195214},
            title: 'NatWest',
            content: '<h3>NatWest</h3><p>NatWest offers a <a href="http://personal.natwest.com/personal/current-accounts/compare-current-accounts/student-account.html">student account</a>. International students can apply for the same account but will not get an overdraft.</p>',
            subplaces: ['international student account']
        },
        {
            latLng: {lat: 55.942596, lng: -3.182890},
            title: 'TSB',
            content: '<h3>TSB</h3><p>TSB offers a <a href="http://www.tsb.co.uk/current-accounts/student-bank-account/">student account</a>. International students can apply for a <a href="http://www.tsb.co.uk/current-accounts/">basic account</a>.</p>',
            subplaces: ['international account']
        }
        ]
      }];

      // ---- Flatten Places ----
      var places = [];
      for (var i = 0; i < placeGroups.length; i++) {
        places = places.concat(placeGroups[i].places);
      }

      // ---- Util functions ----
      function fitToPlaces(map, places) {
        var bounds = new google.maps.LatLngBounds();
        for (var i = 0; i < places.length; i++) {
          bounds.extend(places[i].latLng);
        }
        map.fitBounds(bounds);
      }

      function fitToPlace(map, place) {
        map.setCenter(place.latLng);
      }

      function openAccordion(header) {
        // $('.accordion').children().removeClass('closed');
        $(header).siblings().addClass('closed');
        $(header).removeClass('closed');
        $(header).next().removeClass('closed');
      }

      function initMap() {
        // ---- Create map ----
        var map = new google.maps.Map(document.getElementById('map'));
        window.map = map;

        // ---- Zoom and pan map ----
        var bounds = fitToPlaces(map, places);

        // ---- Populate markers ----
        for (var i = 0; i < places.length; i++) {
          (function (place) {
            place.marker = new google.maps.Marker({
              position: place.latLng,
              map: map,
              title: place.title
            });
            place.infoWindow = new google.maps.InfoWindow({
              content: place.content
            });
            place.marker.addListener('click', function () {
              for (var j = 0; j < places.length; j++) {
                places[j].infoWindow.close();
              }
              place.infoWindow.open(map, place.marker);
            });
          })(places[i]);
        }

        // ---- Create accordion ----
        for (var i = 0; i < placeGroups.length; i++) {
          var group = placeGroups[i];
          // Section header
          var accordionSectionHeader = $('<header>')
            .click(function (evt) {
              openAccordion($(this));
            })
            .appendTo($('#place-buttons'));
          var chevron = $('<i>')
            .addClass('fa fa-chevron-down')
            .appendTo(accordionSectionHeader);
          var groupHeading = $('<h3>')
            .text(group.title)
            .appendTo(accordionSectionHeader);

          // Section content
          var accordionSection = $('<section>')
            .attr('group-idx', i)
            .appendTo($('#place-buttons'));

          // Places
          for (var j = 0; j < group.places.length; j++) {
            var place = group.places[j];
            var button = $('<button>')
              .addClass('place-button')
              .attr('place-idx', j)
              .click(function (evt) {
                var groupIdx = $(this).parent().attr('group-idx');
                var placeIdx = $(this).attr('place-idx');
                fitToPlace(map, placeGroups[groupIdx].places[placeIdx]);
              })
              .appendTo(buttonGroup);
            var buttonHeading = $('<b>')
              .text(place.title)
              .appendTo(button);
            var list = $('<ul>')
              .appendTo(button);

            // Subplaces
            for (var k = 0; k < place.subplaces.length; k++) {
              var subplace = place.subplaces[k];
              var item = $('<li>')
                .text(subplace)
                .appendTo(list);
            }
          }
        }
        openAccordion($('#place-buttons').children().first())
      }
    </script>
    <!-- Google Maps dependency -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBt5ufFlKy1B2RZ627V1sb1-SrpE9THiag&callback=initMap"></script>
  </body>
</html>
